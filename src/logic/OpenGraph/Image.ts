import express from "express"
import Response from "../../utils/Response/Response"
import path from "path"
import {Canvas, Image, NodeCanvasRenderingContext2D} from "canvas"
import db from "../../utils/Database/Database"
import {mc_addons} from "../../../prisma/client"
import findInDir from "../../utils/Search/FindInDir"
import fs from "fs"
import {Buffer} from "buffer"

const {createCanvas, loadImage} = require("canvas")

async function getImage(req: express.Request, res: express.Response) {
	let ID = Number(req.params.id)

	if (!Boolean(ID)) {
		return Response(res, {
			error: true,
			code: 500,
			message: "ID value must be Number. #202130409231100",
		})
	}

	let exists = await isExists(ID)
	if (!exists) {
		return Response(res, {
			error: true,
			code: 404,
			message: "Not Found. #202131108220400",
		})
	}

	let dirPath = path.resolve(process.env.STATIC_DIR + "/og_images")
	let ogImageList = findInDir(dirPath, /\.png$/)

	if (ogImageList.includes(dirPath + "/" + ID + ".png")) {
		return Response(
			res,
			{
				error: false,
			},
			{
				image: ID + ".png",
			}
		)
	}

	// get addon data
	let addon = await getAddonData(ID)

	// create canvas
	const canvas: Canvas = createCanvas(600 * 4, 315 * 4)
	const ctx: NodeCanvasRenderingContext2D = canvas.getContext("2d")

	// apply green background color
	setBackgroundColor(canvas, ctx, "rgb(158, 240, 163)")

	// cover it with some pattern from figma
	await drawImage(
		canvas,
		ctx,
		"data:image/png;base64,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",
		{
			width: canvas.width,
			height: canvas.height,
			x: 0,
			y: 0,
		},
		true
	)

	// draw plugin icon
	await drawImage(
		canvas,
		ctx,
		"/extracted/" + addon.folderpath + "/pack_icon.png",
		{
			width: 400,
			height: 400,
			alignedHorizontally: true,
			border: true,
			borderWeight: 50,
			y: 200 - 20, // -20 because pattern is shifted
		}
	)

	// copyright
	await drawText(canvas, ctx, "MinecraftMods.xyz", {
		fontSize: 32,
		alignedHorizontally: true,
		y: canvas.height - 32 - 35, //fontSize and marginBottom
	})

	// title
	await drawText(canvas, ctx, addon.pack_name, {
		fontSize: 96,
		alignedHorizontally: true,
		y: 745,
	})

	let generatedImageB64 = canvas.toDataURL()
	let imageData = generatedImageB64.replace(/^data:image\/\w+;base64,/, "")
	let imageBuffer = Buffer.from(imageData, "base64")
	fs.writeFileSync(dirPath + "/" + ID + ".png", imageBuffer)

	return Response(
		res,
		{
			error: false,
		},
		{
			image: ID + ".png",
		}
	)
}

async function isExists(id: number): Promise<boolean> {
	let search = await db.mc_addons.count({
		where: {
			id: id,
			isPublished: true,
		},
	})

	return search > 0
}

async function getAddonData(id: number): Promise<mc_addons> {
	return db.mc_addons.findUnique({
		where: {
			id: id,
		},
	})
}

interface IDrawTextStyle {
	fontSize?: number
	fontFamily?: string
	color?: string
	alignedHorizontally?: boolean
	alignedVertically?: boolean
	x?: number
	y?: number
}

interface IDrawImageStyle {
	width?: number
	height?: number
	border?: boolean
	borderWeight?: number
	alignedHorizontally?: boolean
	alignedVertically?: boolean
	x?: number
	y?: number
}

interface IDrawRectStyle {
	x?: number
	y?: number
	width?: number
	height?: number
	color?: string
}

function setBackgroundColor(
	canvas: Canvas,
	ctx: NodeCanvasRenderingContext2D,
	background: string
) {
	ctx.fillStyle = background
	ctx.fillRect(0, 0, canvas.width, canvas.height)
}

async function drawText(
	canvas: Canvas,
	ctx: NodeCanvasRenderingContext2D,
	text: string,
	style?: IDrawTextStyle
) {
	// set default styles and also concat them with user styles...
	style = Object.assign(
		{},
		{
			fontSize: 96,
			fontFamily: "Impact",
			color: "rgb(0, 0, 0)",
			alignedHorizontally: false,
			alignedVertically: false,
			x: 0,
			y: 0,
		},
		style
	)

	ctx.fillStyle = style.color // black or rgb(0, 0, 0)
	ctx.font = style.fontSize + "px " + style.fontFamily // 96px Impact

	if (style.alignedHorizontally) {
		let textWidth: number = ctx.measureText(text).width
		style.x = canvas.width / 2 - textWidth / 2
	}

	if (style.alignedVertically) {
		style.y = canvas.height / 2 - style.fontSize / 2
	}

	ctx.fillText(
		text.trim(),
		style.x,
		style.y + style.fontSize / 2 + style.fontSize / 4
	)
	// style.fontSize is divided by 2 to count just line height,
	// and then by 4 to include extra height of some letters like y,b etc (that is go beyond line height) (also caps locked letters)
	// and that is no rule for 4, it is just my random magic number lol
}

async function drawImage(
	canvas: Canvas,
	ctx: NodeCanvasRenderingContext2D,
	imagePath: string,
	style?: IDrawImageStyle,
	isBase64: boolean = false
) {
	style = Object.assign(
		{},
		{
			width: 100,
			height: 100,
			border: false,
			borderWeight: 10,
			alignedHorizontally: false,
			alignedVertically: false,
			x: 0,
			y: 0,
		},
		style
	)

	let staticDir = path.resolve(process.env.STATIC_DIR)

	let image: Image
	if (isBase64) {
		image = new Image()
		image.src = imagePath
	} else {
		image = await loadImage(staticDir + imagePath)
	}

	// todo: horizontally and v-ly if/else
	if (style.alignedHorizontally) {
		style.x = canvas.width / 2 - style.width / 2
	}

	if (style.alignedVertically) {
		style.y = canvas.height / 2 - style.height / 2
	}

	// todo: border
	if (style.border) {
		let borderStyle = {
			x: style.x - style.borderWeight,
			y: style.y - style.borderWeight,
			width: style.width + style.borderWeight * 2,
			height: style.height + style.borderWeight * 2,
		}

		await drawRectangle(canvas, ctx, borderStyle)
	}

	ctx.drawImage(image, style.x, style.y, style.width, style.height)
}

async function drawRectangle(
	canvas: Canvas,
	ctx: NodeCanvasRenderingContext2D,
	style?: IDrawRectStyle
) {
	style = Object.assign(
		{},
		{
			x: 0,
			y: 0,
			width: 100,
			height: 100,
			color: "rgb(255, 255, 255)",
		},
		style
	)

	ctx.fillStyle = style.color
	ctx.rect(style.x, style.y, style.width, style.height)
	ctx.fill()
}

export default getImage
